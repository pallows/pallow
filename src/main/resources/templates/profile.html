<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
  <script src="/js/auth.js" defer></script>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Profile Page</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;700&display=swap" rel="stylesheet">
  <style>
    body {font-family: 'Noto Sans KR', sans-serif;}
    .userboard-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 20px;
      margin-top: 30px;
    }
    .userboard-item {
      aspect-ratio: 1 / 1;
      overflow: hidden;
      cursor: pointer;
      position: relative;
    }
    .userboard-item img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }
    .userboard-item-overlay {
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      background-color: rgba(0, 0, 0, 0.7);
      color: white;
      padding: 10px;
      opacity: 0;
      transition: opacity 0.3s;
    }
    .userboard-item:hover .userboard-item-overlay {
      opacity: 1;
    }
  </style>
  <link rel="icon" href="https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2FoXBYw%2FbtsIPXrDjTc%2FpLzzFxLchTAtiBSFLAfEX1%2Fimg.png" type="image/x-icon">
</head>
<body class="bg-gray-100">
<header class="flex justify-between items-center p-4 bg-white shadow">
  <div class="flex items-center">
    <a href="/public/main">
      <img src="https://github.com/user-attachments/assets/38c43d3b-dce7-422c-b89a-572308799e96" width="70" height="70" alt="Logo" class="mr-4">
    </a>
    <nav>
      <a href="/public/main" class="mr-4">홈</a>
      <a href="/public/userboardCollection" class="mr-4">오늘의 동친</a>
      <a href="/public/meetsCollection" class="mr-4">내 주변 모임</a>
      <a href="/public/MyPage" class="mr-4">MyPage</a>
      <a href="/public/userboardCollection" class="mr-4">내 게시물 작성하기</a>
    </nav>
  </div>
  <div class="flex items-center">
    <button id="logoutBtn" class="bg-black text-white px-4 py-2 rounded">로그아웃</button>
  </div>
</header>
<main class="container mx-auto px-4 py-8">
  <div class="text-center mb-8">
    <h1 th:text="${profile.name} + ' 님의 프로필'" class="text-3xl font-bold"></h1>
  </div>
  <div class="bg-white shadow rounded-lg p-8">
    <div class="flex items-center mb-8">
      <div class="relative w-24 h-24">
        <img id="profilePicture" th:src="@{${profile.image}}" alt="Profile Picture" class="w-full h-full rounded-full">
        <input type="file" id="profilePictureInput" class="hidden">
      </div>
      <div id="profile">
        <h1 th:text="${profile.name}">Profile Name</h1>
        <h2 th:text="${profile.position}">Profile Position</h2>
      </div>
    </div>
    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-8">
      <div>
        <label class="block text-gray-700">지역</label>
          <p id="profileRegionText" th:text="${profile.position}" class="w-full border border-gray-300 rounded px-4 py-2"></p>
      </div>
      <div>
        <label class="block text-gray-700">생년월일</label>
        <p id="profileBirth" th:text="${profile.birth}" class="w-full border border-gray-300 rounded px-4 py-2"></p>
      </div>
      <div>
        <label class="block text-gray-700">취미</label>
        <p id="profileHobby" th:text="${profile.hobby}" class="w-full border border-gray-300 rounded px-4 py-2"></p>
      </div>
      <div>
        <label class="block text-gray-700">MBTI</label>
        <p id="profileMbti" th:text="${profile.mbti}" class="w-full border border-gray-300 rounded px-4 py-2"></p>
      </div>
      <div class="col-span-2">
        <label class="block text-gray-700">본인 소개</label>
        <textarea id="profileDescription" class="w-full border border-gray-300 rounded px-4 py-2" th:text="${profile.content}">헬로우에서 좋은 모임을 갖고 싶은 사람입니다.</textarea>
      </div>

      <div>
        <label class="block text-gray-700">흡연 여부</label>
        <p id="profileSmoking" class="w-full border border-gray-300 rounded px-4 py-2"></p>
      </div>

      <div>
        <label class="block text-gray-700">음주 여부</label>
        <p id="profileAlcohol"  class="w-full border border-gray-300 rounded px-4 py-2"></p>
      </div>

      <div>
        <label class="block text-gray-700">이상형</label>
        <p id="profileIdeal" class="w-full border border-gray-300 rounded px-4 py-2"></p>
      </div>

      <div>
        <label class="block text-gray-700">관심사</label>
        <p id="profileInterest"  class="w-full border border-gray-300 rounded px-4 py-2"></p>
      </div>

      <div>
        <label class="block text-gray-700">교육</label>
        <p id="profileEducation" class="w-full border border-gray-300 rounded px-4 py-2"></p>
      </div>

      <div>
        <label class="block text-gray-700">직업</label>
        <p id="profileJobs" class="w-full border border-gray-300 rounded px-4 py-2"></p>
      </div>

      <div>
        <label class="block text-gray-700">성격</label>
        <p id="profilePersonality" class="w-full border border-gray-300 rounded px-4 py-2"></p>
      </div>

      <div>
        <label class="block text-gray-700">종교</label>
        <p id="profileReligion" class="w-full border border-gray-300 rounded px-4 py-2"></p>
      </div>
      <div>
        <label class="block text-gray-700">장점</label>
        <p id="profilePros" class="w-full border border-gray-300 rounded px-4 py-2"></p>
      </div>
      <div>
        <label class="block text-gray-700">찾는 친구</label>
        <p id="profileRelationship" class="w-full border border-gray-300 rounded px-4 py-2"></p>
      </div>

      <div class="mt-12 border-t pt-8">
        <h2 th:text="${profile.name} + ' 님의 게시물'" class="text-3xl font-bold"></h2>
        <div id="userboardGrid" class="userboard-grid">
          <!-- UserBoard 아이템들이 여기에 동적으로 추가됩니다 -->
        </div>
      </div>

    </div>
  </div>
</main>
</body>

<script th:inline="javascript">
  const profile = [[${profile}]];
  const curUserId = [[${userId}]];
</script>

<script type="module">
  import {interests, ideals, alcoholPreferences, educationLevels, jobTypes, personalities,
    pros, relationships, religions, smokings } from "/js/predefinedData.js";

  const accessToken = localStorage.getItem('Authorization');
  const userboardGrid = document.getElementById('userboardGrid');
  const idealArray = profile.ideal.split(',');
  const interestArray = profile.interest.split(',');
  let idealText = '';
  let interestText = '';

  idealArray.forEach((value, index) => {
    idealText += ideals[value];
    if (index < idealArray.length - 1) {
      idealText += ', ';
    }
  });

  interestArray.forEach((value, index) => {
    interestText += interests[value];
    if (index < interestArray.length - 1) {
      interestText += ', ';
    }
  });

  document.addEventListener('DOMContentLoaded', () => {
    document.getElementById('profileSmoking').textContent = smokings[profile.smoking] || profile.smoking;
    document.getElementById('profileAlcohol').textContent = alcoholPreferences[profile.alcohol] || profile.alcohol;
    document.getElementById('profileIdeal').textContent = idealText;
    document.getElementById('profileInterest').textContent = interestText;
    document.getElementById('profileEducation').textContent = educationLevels[profile.education] || profile.education;
    document.getElementById('profileJobs').textContent = jobTypes[profile.jobs] || profile.jobs;
    document.getElementById('profilePersonality').textContent = personalities[profile.personality] || profile.personality;
    document.getElementById('profileReligion').textContent = religions[profile.religion] || profile.religion;
    document.getElementById('profilePros').textContent = pros[profile.pros] || profile.pros;
    document.getElementById('profileRelationship').textContent = relationships[profile.relationship] || profile.relationship;
  });

  function loadUserBoards(userId) {

    if (!userId) {
      throw new Error('User ID is not available');
    }
    return fetch(`/users/${userId}/userboards`, {
      method: 'GET',
      headers: {
        'Authorization': accessToken,
        'Content-Type': 'application/json'
      }
    })
    .then(response => {
      if (!response.ok) {
        throw new Error(`HTTP error! status: ${response.status}`);
      }
      return response.json();
    })
    .then(data => {
      if (data.statusCode === 200) {
        const userboards = data.data;
        userboardGrid.innerHTML = ''; // 기존 내용 초기화
        if (userboards.length === 0) {
          userboardGrid.innerHTML = '<p>No userboards found.</p>';
          return;
        }
        userboards.forEach(board => {
          const boardElement = document.createElement('div');
          boardElement.className = 'userboard-item';
          boardElement.innerHTML = `
            <img src="${board.image}" alt="${board.title}">
            <div class="userboard-item-overlay">
              <h3 class="font-bold">${board.title}</h3>
              <p class="text-sm">${new Date(board.createdAt).toLocaleDateString()}</p>
            </div>
          `;
          boardElement.addEventListener('click', () => {
            window.location.href = `/public/userboard?id=${board.id}`;
          });
          userboardGrid.appendChild(boardElement);
        });
      } else {
        throw new Error(data.message || 'Failed to load userboards');
      }
    });
  }
  loadUserBoards(curUserId);
</script>

</html>
