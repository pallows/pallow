<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
  <script src="/js/auth.js" defer></script>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>오늘의 동친</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;700&display=swap" rel="stylesheet">
  <style>
    body {
      body {font-family: 'Noto Sans KR', sans-serif;}
    }
    .card-overlay {
      opacity: 0;
      transition: opacity 0.3s ease, transform 0.3s ease;
    }
    .card:hover .card-overlay {
      opacity: 1;
    }
    .card:hover {
      transform: scale(1.03);
      transition: transform 0.3s ease;
    }
  </style>
  <link rel="icon" th:href="@{https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2FoXBYw%2FbtsIPXrDjTc%2FpLzzFxLchTAtiBSFLAfEX1%2Fimg.png}" type="image/x-icon">
</head>
<body class="bg-gray-100">
<header class="flex justify-between items-center p-4 bg-white shadow">
  <div class="flex items-center">
    <a href="/public/main">
      <img src="https://github.com/user-attachments/assets/38c43d3b-dce7-422c-b89a-572308799e96" width="70" height="70" alt="Logo" class="mr-4">
    </a>
    <nav>
      <a th:href="@{/public/main}" class="mr-4">홈</a>
      <a href="/public/userboardCollection" class="mr-4">오늘의 동친</a>
      <a href="/public/meetsCollection" class="mr-4">내 주변 모임</a>
      <a href="/public/MyPage" class="mr-4">MyPage</a>
    </nav>
  </div>
  <div class="flex items-center">
    <button id="profileBtn" class="mr-4">내 프로필</button>
    <button id="logoutBtn" class="bg-black text-white px-4 py-2 rounded">로그아웃</button>
  </div>
</header>
<main class="container mx-auto px-4 py-8 max-w-6xl">
  <div class="text-center mb-8">
    <h1 class="text-3xl font-bold">오늘의 동친</h1>
  </div>
  <div class="mt-8 grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6">
    <div th:each="profile : ${profiles}" class="card relative bg-white rounded-lg shadow-lg overflow-hidden transition-all duration-300">
      <img th:src="${profile.image}" alt="Profile Photo" class="w-full h-64 object-cover">
      <div class="card-overlay absolute inset-0 bg-black bg-opacity-50 flex flex-col justify-end p-4 text-white">
        <h2 th:text="${profile.name}" class="text-xl font-semibold"></h2>
        <p th:text="${profile.content}" class="text-sm mt-2"></p>
      </div>
      <a th:href="@{/public/userboard(profileId=${profile.id})}" class="absolute inset-0"></a>
    </div>
  </div>

  <div id="paginationContainer" class="mt-8 flex justify-center">
    <nav aria-label="Page navigation" th:if="${profiles.totalPages > 1}">
      <ul class="inline-flex items-center -space-x-px">
        <li th:if="${profiles.hasPrevious()}">
          <a th:href="@{/public/userboardCollection(page=${profiles.number - 1})}" class="px-3 py-2 ml-0 leading-tight text-gray-500 bg-white border border-gray-300 rounded-l-lg hover:bg-gray-100 hover:text-gray-700">
            Previous
          </a>
        </li>
        <li th:each="pageNumber : ${#numbers.sequence(0, profiles.totalPages - 1)}">
          <a th:href="@{/public/userboardCollection(page=${pageNumber})}"
             th:text="${pageNumber + 1}"
             th:class="${pageNumber == profiles.number} ? 'z-10 px-3 py-2 leading-tight text-blue-600 border border-blue-300 bg-blue-50 hover:bg-blue-100 hover:text-blue-700' : 'px-3 py-2 leading-tight text-gray-500 bg-white border border-gray-300 hover:bg-gray-100 hover:text-gray-700'">
          </a>
        </li>
        <li th:if="${profiles.hasNext()}">
          <a th:href="@{/public/userboardCollection(page=${profiles.number + 1})}" class="px-3 py-2 leading-tight text-gray-500 bg-white border border-gray-300 rounded-r-lg hover:bg-gray-100 hover:text-gray-700">
            Next
          </a>
        </li>
      </ul>
    </nav>
  </div>
</main>

<script type="module">
  document.addEventListener('DOMContentLoaded', function() {
    const accessToken = localStorage.getItem('Authorization');
    if (!accessToken) {
      window.location.href = '/login';
      return;
    }

    function fetchWithAuth(url, options = {}) {
      options.headers = {
        ...options.headers,
        'Authorization': accessToken,
        'Content-Type': 'application/json'
      };
      return fetch(url, options);
    }

    document.getElementById('logoutButton').addEventListener('click', function() {
      localStorage.removeItem('Authorization');
      window.location.href = '/login';
    });

    // Add event listeners to pagination links
    document.querySelectorAll('#paginationContainer a').forEach(link => {
      link.addEventListener('click', async (e) => {
        e.preventDefault();
        const url = new URL(e.target.href);
        const page = url.searchParams.get('page');
        await loadUserBoards(page ? parseInt(page, 10) : 0);
      });
    });

    async function loadUserBoards(page = 0) {
      try {
        const response = await fetchWithAuth(`/public/userboardCollection?page=${page}`);
        const html = await response.text();

        // Parse the HTML and update the relevant parts of the page
        const parser = new DOMParser();
        const doc = parser.parseFromString(html, 'text/html');

        const userBoardsContainer = doc.getElementById('userBoardsContainer');
        if (userBoardsContainer) {
          document.getElementById('userBoardsContainer').innerHTML = userBoardsContainer.innerHTML;
        }

        const paginationContainer = doc.getElementById('paginationContainer');
        if (paginationContainer) {
          document.getElementById('paginationContainer').innerHTML = paginationContainer.innerHTML;
        }

        // Reattach event listeners to the new pagination links
        document.querySelectorAll('#paginationContainer a').forEach(link => {
          link.addEventListener('click', async (e) => {
            e.preventDefault();
            const url = new URL(e.target.href);
            const newPage = url.searchParams.get('page');
            await loadUserBoards(newPage ? parseInt(newPage, 10) : 0);
          });
        });

      } catch (error) {
        console.error('Error loading user boards:', error);
      }
    }
  });
</script>
</body>
</html>